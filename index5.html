<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Classroom</title>
  <link rel="icon" type="image/x-icon" href="https://ssl.gstatic.com/classroom/ic_product_classroom_32.png" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet" />
  <style>
    /* ... unchanged styles ... */
  </style>
</head>
<body>
  <h1>ðŸš€ ZXS MOVIE LAUNCHER</h1>
<div class="tab-container">
  <button class="tab-button active" data-tab="movies" onclick="showTab('movies')">Movies</button>
  <button class="tab-button" data-tab="tvshows" onclick="showTab('tvshows')">TV Shows</button>
  <button class="tab-button" data-tab="search" onclick="showTab('search')">Cloak</button>
</div>

  <!-- Movies Tab -->
  <div id="movies" class="container">
    <div class="input-container">
      <input id="movieMediaId" type="text" placeholder="Enter Movie IMDB ID">
      <select id="movieProvider">
        <option value="vidsrc">Vidsrc (.to)</option>
        <option value="frembed">Vidsrc (.xyz)</option> 
        <option value="autoembed">Vidsrc (.in)</option>
        <option value="upcloud">Broken (.cc)</option>
        <option value="smashystream">Vidsrc (.net)</option> 
        <option value="superembed">Embedsu</option>
      </select>
      <button onclick="playMovie()">â–¶ Play Movie</button>
    </div>
    <iframe id="moviePlayer" src="" allowfullscreen></iframe>
    <div class="logged-ids" id="movieLog">
      <h3>Logged Movie TMDB IDs</h3>
      <ul id="movieIdList"></ul>
    </div>
  </div>
  <!-- TV Shows Tab -->
  <div id="tvshows" class="container" style="display: none;">
    <div class="input-container">
      <input id="tvMediaId" type="text" placeholder="Enter TV Show TMDB ID">
      <input id="seasonNumber" type="number" placeholder="Season" min="1">
      <input id="episodeNumber" type="number" placeholder="Episode" min="1">
      <select id="tvProvider">
        <option value="vidsrc">Vidsrc (.to)</option>
        <option value="frembed">Vidsrc (.xyz)</option> 
        <option value="autoembed">Vidsrc (.in)</option>
        <option value="smashystream">Vidsrc (.net)</option> 
        <option value="upcloud">Vidsrc (.cc)</option> 
        <option value="superembed">Embedsu</option>
      </select>
      <button onclick="playTvShow()">â–¶ Play TV Show</button>
    </div>
    <iframe id="tvPlayer" src="" allowfullscreen></iframe>
    <div class="logged-ids" id="tvLog">
      <h3>Logged TV Show TMDB IDs</h3>
      <ul id="tvIdList"></ul>
    </div>
  </div>
  <!-- Search Tab -->
 <div id="search" class="container" style="display: none;">
  <div class="input-container">
    <select id="idType" style="flex: 0 0 150px;" onchange="toggleSeasonEpisodeInputs()">
      <option value="imdb">IMDb ID</option>
      <option value="tmdb">TMDb ID</option>
    </select>
    <input id="cloakMediaId" type="text" placeholder="Enter ID" style="flex: 1 1 200px;" />
    <input id="cloakSeasonNumber" type="number" placeholder="Season" min="1" style="flex: 0 0 100px;" />
    <input id="cloakEpisodeNumber" type="number" placeholder="Episode" min="1" style="flex: 0 0 100px;" />
    <select id="cloakProvider" style="flex: 0 0 180px;">
      <option value="frembed">Vidsrc (.xyz)</option> 
      <option value="vidsrc">Vidsrc (.to)</option>
      <option value="autoembed">Vidsrc (.in)</option>
      <option value="upcloud">Vidsrc (.cc)</option>
      <option value="smashystream">Vidsrc (.net)</option> 
      <option value="superembed">Embedsu</option>
    </select>
    <button onclick="launchCloak()">â–¶ Launch</button>
  </div>
  <p style="text-align:center; font-size: 0.9rem; color: #888;">Opens video in a new tab with cloaked URL (Movies only Rn IMDB)</p>
</div>

  <script>
    const apiKey = 'a24c4f9e8a288d266b2453d737f19f54'; 

    // Store TMDB IDs
    const movieIdSet = new Set();
    const tvIdSet = new Set();

    // Function to update list display
    function updateIdList(logId, idSet) {
      const list = document.getElementById(logId);
      list.innerHTML = '';
      idSet.forEach(id => {
        const li = document.createElement('li');
        li.textContent = id;
        list.appendChild(li);
      });
    }

    // ---- FIXED: Tab switching, ensure showTab is global ----
    function showTab(tab) {
      const tabs = ['movies', 'tvshows', 'search'];
      tabs.forEach(t => {
        document.getElementById(t).style.display = (t === tab) ? 'block' : 'none';
      });

      const buttons = document.querySelectorAll('.tab-button');
      buttons.forEach(button => {
        button.classList.remove('active');
      });

      const activeButton = document.querySelector(`.tab-button[data-tab="${tab}"]`);
      if (activeButton) activeButton.classList.add('active');
    }
    // ---- END FIX ----

    // Display default tab on load
    document.addEventListener('DOMContentLoaded', function() {
      showTab('movies');
      toggleSeasonEpisodeInputs();
    });

    function toggleSeasonEpisodeInputs() {
      const idType = document.getElementById("idType").value;
      const seasonInput = document.getElementById("cloakSeasonNumber");
      const episodeInput = document.getElementById("cloakEpisodeNumber");
      if (idType === "tmdb") {
        seasonInput.style.display = "inline-block"; // Show inputs
        episodeInput.style.display = "inline-block";
      } else {
        seasonInput.style.display = "none"; // Hide inputs for IMDb
        episodeInput.style.display = "none";
      }
    }

    // Show media in appropriate tab inputs
    function showMedia(id, type) {
      if (type === "movie") {
        document.getElementById("movieMediaId").value = id;
        showTab('movies');
      } else if (type === "tv") {
        document.getElementById("tvMediaId").value = id;
        showTab('tvshows');
      }
    }

    // Play movie + log ID
    function playMovie() {
      const mediaId = document.getElementById("movieMediaId").value.trim();
      if (!mediaId) return alert("Please enter a TMDB ID for the movie.");
      const provider = document.getElementById("movieProvider").value;
      let url = "";
      switch (provider) {
        case "frembed": url = `https://vidsrc.xyz/embed/movie?imdb=${mediaId}`; break;
        case "superembed": url = `https://embed.su/embed/movie/${mediaId}`; break;
        case "smashystream": url = `https://vidsrc.net/embed/movie?imdb=${mediaId}`; break;
        case "autoembed": url = `https://vidsrc.in/embed/movie/${mediaId}`; break;
        case "upcloud": url = `https://vidsrc.cc/embed/movie/${mediaId}`; break;
        case "vidsrc": url = `https://vidsrc.to/embed/movie/${mediaId}`; break;
      }
      document.getElementById("moviePlayer").src = url;

      if (!movieIdSet.has(mediaId)) {
        movieIdSet.add(mediaId);
        updateIdList("movieIdList", movieIdSet);
      }
    }

    // Play TV show + log ID
    function playTvShow() {
      const mediaId = document.getElementById("tvMediaId").value.trim();
      const seasonNumber = document.getElementById("seasonNumber").value.trim();
      const episodeNumber = document.getElementById("episodeNumber").value.trim();
      if (!mediaId || !seasonNumber || !episodeNumber) return alert("Please enter all details for the TV show.");
      const provider = document.getElementById("tvProvider").value;
      let url = "";
      switch (provider) {
        case "frembed": url = `https://vidsrc.xyz/embed/tv/${mediaId}/${seasonNumber}/${episodeNumber}`; break;
        case "superembed": url = `https://embed.su/embed/tv/${mediaId}/${seasonNumber}/${episodeNumber}`; break;
        case "smashystream": url = `https://vidsrc.net/embed/tv/${mediaId}/${seasonNumber}/${episodeNumber}`; break;
        case "autoembed": url = `https://vidsrc.in/embed/tv/${mediaId}/${seasonNumber}/${episodeNumber}`; break;
        case "upcloud": url = `https://vidsrc.cc/embed/tv/${mediaId}/${seasonNumber}/${episodeNumber}`; break;
        case "vidsrc": url = `https://vidsrc.to/embed/tv/${mediaId}/${seasonNumber}/${episodeNumber}`; break;
      }
      document.getElementById("tvPlayer").src = url;

      if (!tvIdSet.has(mediaId)) {
        tvIdSet.add(mediaId);
        updateIdList("tvIdList", tvIdSet);
      }
    }

    async function launchCloak() {
      const idType = document.getElementById("idType").value;
      const inputId = document.getElementById("cloakMediaId").value.trim();
      if (!inputId) {
        return alert("Please enter an ID.");
      }
      const provider = document.getElementById("cloakProvider").value;
      try {
        let imdbId = inputId;
        if (idType === "tmdb") {
          // Convert TMDb ID to IMDb ID using TMDb API "external_ids"
          const response = await fetch(`https://api.themoviedb.org/3/movie/${inputId}?api_key=${apiKey}&append_to_response=external_ids`);
          if (!response.ok) throw new Error("Invalid TMDb ID or API error");
          const data = await response.json();
          if (!data.external_ids || !data.external_ids.imdb_id) throw new Error("IMDb ID not found for this TMDb ID");
          imdbId = data.external_ids.imdb_id.replace(/^tt/, ''); // remove 'tt' prefix for embed URLs
        } else {
          // If IMDb ID entered, strip 'tt' if present
          imdbId = inputId.replace(/^tt/, '');
        }
        const seasonNumber = document.getElementById("cloakSeasonNumber").value.trim();
        const episodeNumber = document.getElementById("cloakEpisodeNumber").value.trim();

        // Construct the embed URL based on provider
        let url = "";
        if (idType === "tmdb" && seasonNumber && episodeNumber) {
          // TV show episode embed URL with TMDb ID (use query format, works across all domains)
          switch (provider) {
            case "frembed": url = `https://vidsrc.xyz/embed/tv?tmdb=${inputId}&season=${seasonNumber}&episode=${episodeNumber}`; break;
            case "superembed": url = `https://embed.su/embed/tv?tmdb=${inputId}&season=${seasonNumber}&episode=${episodeNumber}`; break;
            case "smashystream": url = `https://vidsrc.net/embed/tv?tmdb=${inputId}&season=${seasonNumber}&episode=${episodeNumber}`; break;
            case "autoembed": url = `https://vidsrc.in/embed/tv?tmdb=${inputId}&season=${seasonNumber}&episode=${episodeNumber}`; break;
            case "upcloud": url = `https://vidsrc.cc/embed/tv?tmdb=${inputId}&season=${seasonNumber}&episode=${episodeNumber}`; break;
            case "vidsrc": url = `https://vidsrc.to/embed/tv?tmdb=${inputId}&season=${seasonNumber}&episode=${episodeNumber}`; break;
          }
        } else {
          // Movie embed logic (IMDb or TMDb converted to IMDb)
          switch (provider) {
            case "frembed": url = `https://vidsrc.xyz/embed/movie?imdb=${imdbId}`; break;
            case "superembed": url = `https://embed.su/embed/movie/${imdbId}`; break;
            case "smashystream": url = `https://vidsrc.net/embed/movie?imdb=${imdbId}`; break;
            case "autoembed": url = `https://vidsrc.in/embed/movie/${imdbId}`; break;
            case "upcloud": url = `https://vidsrc.cc/embed/movie/${imdbId}`; break;
            case "vidsrc": url = `https://vidsrc.to/embed/movie/${imdbId}`; break;
          }
        }

        // Open about:blank window
        const win = window.open('about:blank');
        // Setup blank page with iframe for embed URL
        win.document.write(`
          <html>
            <head>
              <title>Video Player</title>
              <style>
                body,html { margin:0; height:100%; overflow:hidden; background:#000; }
                iframe { border:none; width:100%; height:100%; }
              </style>
            </head>
            <body>
              <iframe src="${url}" allowfullscreen></iframe>
            </body>
          </html>
        `);
        win.document.close();
      } catch (error) {
        alert(`Error: ${error.message}`);
      }
    }
  </script>
</body>
</html>
